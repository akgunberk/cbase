// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../lib/database.db"
}

model User {
  @@id([id,username])
  id        String            @unique
  username  String            @unique
  firstName String
  lastName  String
  project   UsersOnProjects[]
  queries   CodebaseQuery[]
}

model Project {
  id         Int               @id @default(autoincrement())
  name       String            @unique
  users      UsersOnProjects[]
  tickets    Ticket[]
  statuses   Status[]
  priorities Priority[]
  categories Category[]
  types      Type[]
}

model UsersOnProjects {
  project     Project @relation(fields: [projectName], references: [name])
  projectName String
  user        User    @relation(fields: [userId,username], references: [id,username])
  userId      String
  username    String

  @@id([projectName, userId])
}

model CodebaseQuery {
  id       Int    @id @default(autoincrement())
  name     String @unique
  query    String
  user     User   @relation(fields: [username], references: [username])
  username String
}

model Ticket {
  ticketId    String   @id
  summary     String
  ticketType  String
  assignee    String
  reporter    String
  categoryId  String
  statusId    String
  priorityId  String
  projectName String
  project     Project  @relation(fields: [projectName], references: [name])
  type        Type     @relation(fields: [ticketType], references: [name])
  category    Category @relation(fields: [categoryId], references: [id])
  status      Status   @relation(fields: [statusId], references: [id])
  priority    Priority @relation(fields: [priorityId], references: [id])
}

model Status {
  id            String   @id
  name          String   @unique
  colour        String
  treatAsClosed Boolean
  Ticket        Ticket[]
  projectName   String
  project       Project  @relation(fields: [projectName], references: [name])
}

model Category {
  id          String   @id
  name        String   @unique
  Ticket      Ticket[]
  projectName String
  project     Project  @relation(fields: [projectName], references: [name])
}

model Type {
  id          String   @id
  name        String   @unique
  icon        String
  Ticket      Ticket[]
  projectName String
  project     Project  @relation(fields: [projectName], references: [name])
}

model Priority {
  id          String   @id
  name        String   @unique
  colour      String
  Ticket      Ticket[]
  projectName String
  project     Project  @relation(fields: [projectName], references: [name])
}
